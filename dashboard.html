<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Data Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .search-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #fcc;
        }

        .identity-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .identity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .identity-name {
            font-size: 2em;
            color: #333;
            font-weight: 700;
        }

        .identity-id {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .data-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .data-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            font-size: 1.2em;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 600;
            color: #495057;
        }

        .data-value {
            color: #333;
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }

        .phone-list, .device-list, .behavior-list, .property-list {
            space-y: 10px;
        }

        .list-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
        }

        .workspace-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }

        .no-data {
            text-align: center;
            padding: 60px;
            color: white;
            font-size: 18px;
        }

        .raw-data {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .toggle-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .identity-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Enhanced Data Dashboard</h1>
            <p>Visualize and explore enhanced identity data from your D1 database</p>
        </div>

        <div class="search-section">
            <div class="search-form">
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="text" id="phone" placeholder="e.g., 6102991669" />
                </div>
                <div class="form-group">
                    <label for="workspace">Workspace ID</label>
                    <input type="text" id="workspace" placeholder="e.g., 5648" />
                </div>
                <button class="search-btn" onclick="fetchIdentityData()">üîç Search</button>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://api.enhanced-data.channelautomation.com';
        
        async function fetchIdentityData() {
            const phone = document.getElementById('phone').value.trim();
            const workspace = document.getElementById('workspace').value.trim();
            const resultsDiv = document.getElementById('results');

            if (!phone || !workspace) {
                resultsDiv.innerHTML = '<div class="error">Please enter both phone number and workspace ID</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="loading">üîÑ Fetching data...</div>';

            try {
                const response = await fetch(`${API_BASE}/get-identity/${phone}?workspace_id=${workspace}`);
                const data = await response.json();

                if (data.success) {
                    displayIdentityData(data);
                } else {
                    resultsDiv.innerHTML = `<div class="error">‚ùå ${data.error || 'Identity not found'}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error fetching data: ${error.message}</div>`;
            }
        }

        function displayIdentityData(data) {
            const identity = data.identity;
            const related = data.related_data;
            
            const html = `
                <div class="identity-card">
                    <div class="identity-header">
                        <div>
                            <div class="identity-name">üë§ ${identity.first_name} ${identity.last_name}</div>
                            <div style="color: #666; margin-top: 5px;">
                                üì± ${identity.phone} 
                                <span class="workspace-badge">Workspace: ${identity.workspace_id}</span>
                            </div>
                        </div>
                        <div class="identity-id">ID: ${identity.identity_id}</div>
                    </div>

                    <div class="data-grid">
                        <!-- Basic Information -->
                        <div class="data-section">
                            <h3><span class="icon">üè†</span> Address & Location</h3>
                            <div class="data-item">
                                <span class="data-label">Address:</span>
                                <span class="data-value">${identity.address}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">City:</span>
                                <span class="data-value">${identity.city}, ${identity.state}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">ZIP:</span>
                                <span class="data-value">${identity.zip}-${identity.zip4}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">County:</span>
                                <span class="data-value">${identity.county_name}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Coordinates:</span>
                                <span class="data-value">${identity.latitude}, ${identity.longitude}</span>
                            </div>
                        </div>

                        <!-- Personal Details -->
                        <div class="data-section">
                            <h3><span class="icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> Personal Details</h3>
                            <div class="data-item">
                                <span class="data-label">Gender:</span>
                                <span class="data-value">${identity.gender === 'M' ? 'Male' : 'Female'}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Birth Date:</span>
                                <span class="data-value">${identity.birth_date}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Has Email:</span>
                                <span class="data-value">${identity.has_email ? '‚úÖ Yes' : '‚ùå No'}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Validated:</span>
                                <span class="data-value">${identity.validated ? '‚úÖ Yes' : '‚ùå No'}</span>
                            </div>
                        </div>

                        <!-- Demographics -->
                        ${related.demographic ? `
                        <div class="data-section">
                            <h3><span class="icon">üí∞</span> Demographics & Finance</h3>
                            <div class="data-item">
                                <span class="data-label">Income Level:</span>
                                <span class="data-value">${related.demographic.income_level}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Household Income:</span>
                                <span class="data-value">${related.demographic.household_income}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Credit Range:</span>
                                <span class="data-value">${related.demographic.credit_range}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Home Ownership:</span>
                                <span class="data-value">${related.demographic.home_ownership}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Home Value:</span>
                                <span class="data-value">$${related.demographic.home_value?.toLocaleString()}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Marital Status:</span>
                                <span class="data-value">${related.demographic.marital_status}</span>
                            </div>
                        </div>
                        ` : ''}

                        <!-- Phone Numbers -->
                        ${related.phones?.length ? `
                        <div class="data-section">
                            <h3><span class="icon">üì±</span> Phone Numbers (${related.phones.length})</h3>
                            <div class="phone-list">
                                ${related.phones.map(phone => `
                                    <div class="list-item">
                                        <div class="data-item">
                                            <span class="data-label">Phone:</span>
                                            <span class="data-value">${phone.associated_phone}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Carrier:</span>
                                            <span class="data-value">${phone.carrier}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Status:</span>
                                            <span class="data-value">${phone.activity_status} (${phone.contactability_score})</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- Devices -->
                        ${related.devices?.length ? `
                        <div class="data-section">
                            <h3><span class="icon">üì±</span> Devices (${related.devices.length})</h3>
                            <div class="device-list">
                                ${related.devices.map(device => `
                                    <div class="list-item">
                                        <div class="data-item">
                                            <span class="data-label">OS:</span>
                                            <span class="data-value">${device.os}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Device ID:</span>
                                            <span class="data-value">${device.device_id.substring(0, 16)}...</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- Behaviors -->
                        ${related.behaviors?.length ? `
                        <div class="data-section">
                            <h3><span class="icon">üéØ</span> Behaviors (${related.behaviors.length})</h3>
                            <div class="behavior-list">
                                ${related.behaviors.map(behavior => `
                                    <div class="list-item">
                                        <div class="data-item">
                                            <span class="data-label">IAB Category:</span>
                                            <span class="data-value">${behavior.iab_category}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Recency:</span>
                                            <span class="data-value">${behavior.recency} days</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}

                        <!-- Properties -->
                        ${related.properties?.length ? `
                        <div class="data-section">
                            <h3><span class="icon">üè°</span> Properties (${related.properties.length})</h3>
                            <div class="property-list">
                                ${related.properties.map(property => `
                                    <div class="list-item">
                                        <div class="data-item">
                                            <span class="data-label">Address:</span>
                                            <span class="data-value">${property.property_address}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">City:</span>
                                            <span class="data-value">${property.property_city}, ${property.property_state}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Type:</span>
                                            <span class="data-value">${property.property_type}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Value:</span>
                                            <span class="data-value">$${property.property_value?.toLocaleString()}</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Year Built:</span>
                                            <span class="data-value">${property.year_built} (${property.year_built_range})</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Bedrooms:</span>
                                            <span class="data-value">${property.bedrooms}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Raw Data Section -->
                    <div class="data-section" style="margin-top: 30px;">
                        <h3><span class="icon">üìÑ</span> Raw API Response</h3>
                        <button class="toggle-btn" onclick="toggleRawData()">Show/Hide Raw Data</button>
                        <div id="raw-data" class="raw-data" style="display: none; margin-top: 15px;">
                            <pre>${JSON.stringify(data.raw_response, null, 2)}</pre>
                        </div>
                    </div>

                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0; color: #666; text-align: center;">
                        <small>Created: ${identity.created_at} | Updated: ${identity.updated_at}</small>
                    </div>
                </div>
            `;

            document.getElementById('results').innerHTML = html;
        }

        function toggleRawData() {
            const rawData = document.getElementById('raw-data');
            rawData.style.display = rawData.style.display === 'none' ? 'block' : 'none';
        }

        // Auto-fill example data for testing
        window.onload = function() {
            document.getElementById('phone').value = '6102991669';
            document.getElementById('workspace').value = '5648';
        };
    </script>
</body>
</html>